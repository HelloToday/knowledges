### 函数的取值方式B12303

按照B12303后面之后得字符串可以分类的操作来分来

#### 1.直接取值的

* 取值 ${B12303_interestRuleFixedLengthFix@B12307_30} 固定长度 30 位
* 取当前系统相关的属性 --年月日

#### 2. 定长的抽象：取那个字段，从哪儿取值，长度多少，不够的时候填充什么

1. 取值判断 contractAmtFixedLength30-- lonApplication.getContractAmt()

 这个是1.5倍间距 不够30位的的补充一个下划线

2. interestRuleFixedLengthFix --${B12303_interestRuleFixedLengthFix@B12307_30}还款方式固定长度 

   缓存当中存储了所有的还款方式，根据工单里面的productId来获取还款信息

3. loanLimitUnit --借款期限单位（取自产品配置）/intf/external/dubboInterface!commonDubboQueryIntf.intf  入参位producntId 和 查询固定标志queryCfgId=9

4. approveLimit2--借款期数  B12003--一次性还清  返回1  其余的取字段approveLimit

5. repayOpen--还款开户行 工单里面的repayOpen这个属性 根据标准代码类型和标准代码查找对应的中文名称读取缓存

6. 最后一期的还款额 根据productId查询产品的还款设置，从工单里面取出 approveLimit 遍历取出最后一条返回，刊是不是一次性还款，如果是返回0 否则取工单里面的lastRepayAmt

   ```sql
   SELECT t.LAST_REPAY_AMT from t_lon_application t where t.LAST_REPAY_AMT is not null
   ```

7. lastRepayAmt2DX --最后一笔还款大写

8. sumRepayAmt---还款总金额，获取还款计划列表，累计作和 **拼接报文** 大小写都有

**还款计划的获取是个大坑 根据产品名字初始化bean 然后build返回结果**

9. sumFeeAndRepayAmt --带费用的还款总金额 lonApplication.getFeeStages()

   >费用信息来自于"paym_sched_calculate_address" 这个地址
   >
   >入参位channelId  appId productId

10. loanAfterAnagementAmt --贷后管理费

>lonApplication.gettLoanFeeInfolist() 作和
>
>费用列表select * from t_loan_fee_info t where t.app_id=? B6648
>
>来自于数据库

11. arbitrateServiceAmt --仲裁对接技术服务费

    >费用列表select * from t_loan_fee_info t where t.app_id=? B6647 and feeType=?
    >
    >**查询sql可以优化**
    >
    >

12. specialValueMonthLimit --这个太扯了 

    >取月还款额 数据来源于同 6 和7 
    >
    >RepayWay=B12001

13. interestRule--还款方式

    ```sql
    select * from t_mls_loan_create_log_extro
    where APP_ID = 1213
    AND EXTRO_KEY ='repayWay'
    ```

    >1009 的时候用上述方式取值 从缓存系统当中取值 B120
    >
    >其余的同 6,7,12方式的来源一致



14. repayTypeParaphrase --还款方式说明  repayTypeFormula--还款方式计算公式获取

>获取缓存当中的取值
>
>键值BASE.T_PRD_REPAY_WAY_DEFINITION.计息方式.计息单位.单位计息天数.还款方式.版本.算法名称
>
>"BASE.T_PRD_REPAY_WAY_DEFINITION." + interestRule+"."+interestUnit+"."+unitInterestCount+"."+repayWay+"."+version+"."+repayWayCase;
>
>a.首先从工单里面获取产品ID以及相关的属性 查询缓存系统



15. monthlyInterestRate --月利率

获取产品信息



16. serviceFeeAmt--咨询服务费

```sql
select t.ADVISORY_SERVICE_AMT from t_lon_application t where t.ADVISORY_SERVICE_AMT is not null
```

17. enterpriseIndividualName --出借人信息

​     获取抵押人或者受托支付列表 调用webservice , 抵押权人必须为1 不能多也不能少

   最后取出来 --//企业名称/个人姓名

18. enterpriseIndividualNum --出借人身份证

>数据来源于17相同
>
>//法人的个人身份证号

19. 质押合同（贵金属、名表、奢侈品）获取第几项

-- itemNumber

```
if (lonApplication.getLonPawnPms().size()>0) {// 典当贵金属
value = "（一）";
} else if (lonApplication.getLonPawnWatchs().size()>0) {// 典当名表
value = "（二）";
} else if (lonApplication.getLonPawnLuxurys().size()>0) {// 典当奢侈品箱包
value = "（三）";
} else if ( lonApplication.getLonPawnOthers().size()>0) {// 典当其他
value = "（四）";
}
//todo 数据来源在何处设置的？
```

20. 创建时间createTime ---工单表
21. 以Fee_开头的key ${B12303_Fee_B6655}  函数取值 Fee 取值字段_B6655 从feeInfoList 里面筛选出类型为B6655的那条记录lonApplication.gettLoanFeeInfolist()
22. SFee_ 数据来源lonApplication.gettLoanFeeInfolist() 相同 取值类型也相同
23. thirdSumFeeAmt --同21 22来源一致 
24. creditRisksAmt,matchmakingServiceAmt（撮合服务费）

>insuranceServiceAmt（保险费），
>
>mlsInsuranceServiceAmt （保险费（总）针对保险特殊合同）
>
>compensateServiceAmt(补偿备用金人民币)
>
>accountAnagementAmt(账户管理费)
>
>informationtAmt(信息技术支持服务费)----**代码有重复**
>
> -- --同21 22 23来源一致 
>
>

25. comOperateAddress --单位经营地址1566

> 调用贷前，扩展模板信息
>
> comRegsitAddress--单位注册地址
>
> legalPersonName --法人姓名
>
> saleLicenceCode--营业执照号
>
> legalPersonPhone---法人手机号

26. loanAgreementJiaYuan--借款合同（佳缘）

> 1591借款协议（佳缘） 封装了几个数据成html里面的table

27. instmAmt --本息和

```java
	private static BigDecimal calculateRepaySum(TLonApplication lonApplication){
		double sum = 0;
		List<SchedRecordext> list = lonApplication.getOuput();
		for (SchedRecordext schedRecordext : list) {
			sum += schedRecordext.getInstmAmt();//本息和
		}
		return BigDecimal.valueOf(sum).setScale(2,	BigDecimal.ROUND_HALF_UP);
	}
```

28. accOwnName --开户名称（受托支付账户）

    > lonApplication.gettLonAccounts() ----**代码重复**
    >
    > accBankCard----账号（受托支付账户）
    >
    > richAccIDCard --身份证号（富友账户）
    >
    > richAccOwnPhone---手机号（富友账户）
    >
    > richAccountBankCard--账号（富友账户）
    >
    > XJReceiveAccount--消金富友金账户

29. 工单结束日期（年月日）



30. repayAccountOwnPhone ---还款持卡人手机号

31. borrowerName --出借人姓名 

    >借款方姓名
    >
    >borrowerName 根据类型来取值不动听的字段
    >
    >SELECT t.COMPANY,t.CUSTOMER_NAME,t.APP_STATUS from t_lon_application t where t.BORROWER_TYPEType='B154002';
    >
    >B154002--法人
    >
    >B154001---个人
    >
    >---
    >
    >根据borrowtType取值的还有
    >
    >借款人通讯地址
    >
    >SELECT t.LIVE_ADDRESS,t.COMPANY_ADDRESS,t.APP_STATUS from t_lon_application t where t.BORROWER_TYPE='B154002';
    >
    >---borrowerIdNo借款方证件号
    >
    >--B154003机构的话取 可选参数 unifiedSocialCreditCode ---统一社会编码

32. appCars开头的 是如下信息 ---车辆信息 todo---for 循环优化

33. receiveBankCard_ 回款银行信息--取值来自可选参数的入参

34. repayPlan --还款计划

    > 根据工单ID调用贷前接口，扩展模板信息

35. 试算还款计划spreadRepayPlan

>lonApplication.getOuput();
>
>

36 借款方通讯地址 --borrowerPostalAddress 

---借款方联系电话borrowerContactNumber

--monthRepayLimit 月还款额